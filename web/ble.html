<!DOCTYPE html>
<html>

<head>
    <title>Bluetooth Connection</title>
    <style>
        body.connected .unlessConnected,
        .ifConnected {
            display: none
        }

        body.connected .ifConnected {
            display: inherit
        }
    </style>
</head>

<body>
    <button id="bt-connection-button" class="unlessConnected">
        Connect to BLE Device
    </button>
    <button id="bt-disconnect-button" class="ifConnected">
        Disconnect
    </button>
    <p id="sample-rate" class="ifConnected"></p>
    <pre id="imu-q"></pre>
</body>

<script type="module">
    import { onSensorData, disconnect } from "./js/ble.js";

    document.getElementById("bt-disconnect-button").onclick = disconnect;
    let sampleTimes = [];

    onSensorData(({ receivedAt: ts, quaternion: quat }) => {
        sampleTimes = [ts, ...sampleTimes.filter(n => n > ts - 1000)];
        if (Math.floor(ts / 1000) > Math.floor(sampleTimes[1] / 1000)) {
            // console.info(`samples: ${sampleTimes.length}/sec`);
            document.getElementById(
                'sample-rate'
            ).innerText = `${sampleTimes.length} samples/sec`;
        }
        document.getElementById('imu-q').innerText = JSON.stringify(quat);
    })
</script>

</html>
